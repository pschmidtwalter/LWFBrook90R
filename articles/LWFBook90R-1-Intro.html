<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to LWFBrook90R • LWFBrook90R</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to LWFBrook90R">
<meta property="og:description" content="LWFBrook90R">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">LWFBrook90R</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5.4.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/LWFBook90R-1-Intro.html">Introduction to LWFBrook90R</a>
    </li>
    <li>
      <a href="../articles/LWFBrook90R-2-Options_Param.html">Model control options and parameters</a>
    </li>
    <li>
      <a href="../articles/LWFBrook90R-3-Multiruns.html">Multi-run simulations in LWFBrook90R</a>
    </li>
    <li>
      <a href="../articles/LWFBrook90R-4-Multisite-Runs.html">Multi-Site simulations using `run_multisite_LWFB90()`</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pschmidtwalter/LWFBrook90R/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to LWFBrook90R</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/pschmidtwalter/LWFBrook90R/blob/HEAD/vignettes/LWFBook90R-1-Intro.Rmd" class="external-link"><code>vignettes/LWFBook90R-1-Intro.Rmd</code></a></small>
      <div class="hidden name"><code>LWFBook90R-1-Intro.Rmd</code></div>

    </div>

    
    
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>LWF-BROOK90 <span class="citation">(Hammel and Kennel 2001)</span> is
a soil vegetation atmosphere transport (SVAT) model to calculate daily
evaporation (transpiration, interception, and soil evaporation) and soil
water fluxes, along with soil water contents and soil water tension of a
soil profile covered with vegetation. It is an upgraded version of the
original BROOK90 model <span class="citation">(Federer, Vörösmarty, and
Fekete 2003; Federer 2002)</span>, featuring additional
parameterizations of the soil water retention and conductivity functions
<span class="citation">(Mualem 1976; Genuchten 1980)</span>, and the
option to take interannual variation of aboveground vegetation
characteristics into account.</p>
<p>The package core function <code><a href="../reference/run_LWFB90.html">run_LWFB90()</a></code> runs the
LWF-Brook90 by:</p>
<ul>
<li>creating model input objects from climate driving data, model
control options and parameters,</li>
<li>executing the model code,</li>
<li>returning the model output.</li>
</ul>
<p>The model control options thereby let you select different functions
for defining aboveground stand dynamics, phenology, and root length
density depth distributions. Additionally, a set of pedotransfer
functions is provided to derive hydraulic parameters from soil physical
properties.</p>
<p>In this vignette, we will use meteorological and soil data from the
longterm monitoring beech forest site SLB1 in the Solling mountains,
Germany, which are available after loading the package.</p>
<p>To reproduce the examples, load ‘LWFBrook90R’ and the ‘data.table’
package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pschmidtwalter.github.io/LWFBrook90R/">LWFBrook90R</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="basic-usage">Basic usage<a class="anchor" aria-label="anchor" href="#basic-usage"></a>
</h3>
<div class="section level4">
<h4 id="input-objects">Input Objects<a class="anchor" aria-label="anchor" href="#input-objects"></a>
</h4>
<p>As a first step, we need to set up the input objects for the central
function <code>runLWFB90()</code>. Aside from meteorological and soil
data, we need to define the model control options and model parameter
objects. The model options contain basic information about the
simulation and which sub-models to use (e.g. the start and end dates of
the simulation, the precipitation interval, the phenology model, root
length density depth distribution function, etc). The model parameter
object contains about 100 parameters, of which most are required to run
the model, but some only take effect if certain model control options
are selected (see vignette <a href="LWFBrook90R-2-Options_Param.html">Model control options and
parameters</a>). Two functions are available that can be used to
generate default lists of model options and parameters:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">options_b90</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_optionsLWFB90.html">set_optionsLWFB90</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">param_b90</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/set_paramLWFB90.html">set_paramLWFB90</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The created objects can be easily manipulated by reference, or simply
by assigning values to the option and parameter names directly in the
function calls. To look up the meanings of the various options and
parameters see <code><a href="../reference/set_optionsLWFB90.html">?set_optionsLWFB90</a></code> and
<code><a href="../reference/set_paramLWFB90.html">?set_paramLWFB90</a></code>. The meaning and context of most input
parameters (and output variables) can also be looked up in the
documentation of the original BROOK90 model version on <a href="http://www.ecoshift.net/brook/b90doc.html" class="external-link">Tony Federer’s
webpages</a>, which is always a recommended source of information when
working with any BROOK90 version.</p>
<p>To run LWF-BROOK90 for the Solling beech site, we need to prepare the
soil data for the model. The data.frame <code>slb1_soil</code> contains
soil physical data of the soil horizons, but not yet the hydraulic
parameters that LWF-BROOK90 requires. Fortunately, ‘LWFBrook90R’ comes
with a set of pedotransfer functions to derive the Mualem/van Genuchten
(MvG) parameters of the soil water retention and hydraulic conductivity
functions. Here we use texture tabulated values from Wessolek, Renger
&amp; Kaupenjohann <span class="citation">(2009)</span> and create a
data.frame containing the required MvG-parameters along with the soil
physical data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">soil</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">slb1_soil</span>, <span class="fu"><a href="../reference/ptfs.html">hydpar_wessolek_tab</a></span><span class="op">(</span>texture <span class="op">=</span> <span class="va">slb1_soil</span><span class="op">$</span><span class="va">texture</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="single-run-simulation">Single-run simulation<a class="anchor" aria-label="anchor" href="#single-run-simulation"></a>
</h4>
<p>Now we load meteorological dat, and then we are ready to perform a
single-run simulation using the function <code><a href="../reference/run_LWFB90.html">run_LWFB90()</a></code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"slb1_meteo"</span><span class="op">)</span></span>
<span><span class="va">b90res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_LWFB90.html">run_LWFB90</a></span><span class="op">(</span>options_b90 <span class="op">=</span> <span class="va">options_b90</span>,</span>
<span>                     param_b90 <span class="op">=</span> <span class="va">param_b90</span>,</span>
<span>                     climate <span class="op">=</span> <span class="va">slb1_meteo</span>,</span>
<span>                     soil <span class="op">=</span> <span class="va">soil</span><span class="op">)</span></span></code></pre></div>
<p><code><a href="../reference/run_LWFB90.html">run_LWFB90()</a></code> thereby derives the daily stand properties
(<code>lai</code>, <code>sai</code>, <code>height</code>,
<code>densef</code>, <code>age</code>) and root distribution from
parameters, and passes climate, vegetation properties and parameters to
the Fortran dynamic library. After the simulation has finished, a list
with model output (<code>output</code>, <code>layer_output</code>) is
returned, along with the model input (<code>options_b90</code>,
<code>param_b90</code> and derived daily vegetation properties
<code>standprop_daily</code>):</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">b90res</span>, max.level <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ simulation_duration: 'difftime' num 4.07710194587708</span></span>
<span><span class="co">#&gt;   ..- attr(*, "units")= chr "secs"</span></span>
<span><span class="co">#&gt;  $ finishing_time     : POSIXct[1:1], format: "2022-06-10 08:05:46"</span></span>
<span><span class="co">#&gt;  $ model_input        :List of 3</span></span>
<span><span class="co">#&gt;  $ output             :Classes 'data.table' and 'data.frame':    730 obs. of  47 variables:</span></span>
<span><span class="co">#&gt;   ..- attr(*, ".internal.selfref")=&lt;externalptr&gt; </span></span>
<span><span class="co">#&gt;  $ layer_output       :Classes 'data.table' and 'data.frame':    15330 obs. of  15 variables:</span></span>
<span><span class="co">#&gt;   ..- attr(*, ".internal.selfref")=&lt;externalptr&gt;</span></span></code></pre></div>
<p>The list entry <code>output</code> contains calendar variables (‘yr’,
‘mo’, ‘da’, ‘doy’), daily actual evaporation fluxes (‘evap’, ‘tran’,
‘irvp’, ‘isvp’, ‘slvp’, ‘snvp’), potential evaporation and transpiration
fluxes (‘pint’, ‘pslvp’, ‘ptran’), soil water flux (‘flow’, ‘vrfln’) and
state variables (‘swat’, ‘awat’, ‘relawat’). For a detailed description
of all output variables refer to the help pages
(<code><a href="../reference/run_LWFB90.html">?run_LWFB90</a></code>).</p>
<p>To plot the data, it is convenient to derive a <code>Date</code>
object from the calendar variables. We use data.table syntax here:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b90res</span><span class="op">$</span><span class="va">output</span><span class="op">[</span>, <span class="va">dates</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">yr</span>, <span class="va">mo</span>, <span class="va">da</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>A second result set (list item <code>layer_output</code>) contains
daily soil moisture state variables and belowground water fluxes of the
individual soil layers. We want to plot absolute soil water storage
(‘swati’) down to a soil depth of 100 cm, so we need to integrate
<code>b90res$layer_output$swati</code> over the 15 uppermost soil
layers:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">b90res</span><span class="op">$</span><span class="va">layer_output</span><span class="op">[</span>, <span class="va">dates</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">yr</span>, <span class="va">mo</span>, <span class="va">da</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">swat100cm</span> <span class="op">&lt;-</span> <span class="va">b90res</span><span class="op">$</span><span class="va">layer_output</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">nl</span> <span class="op">&lt;=</span> <span class="fl">15</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>swat100cm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">swati</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                by  <span class="op">=</span> <span class="va">dates</span><span class="op">]</span></span></code></pre></div>
<p>Now we can plot soil water storage and transpiration:</p>
<div class="figure">
<img src="LWFBook90R-1-Intro_files/figure-html/unnamed-chunk-9-1.png" alt="Simulation results for sample data" width="672"><p class="caption">
Simulation results for sample data
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-federer_brook_2002" class="csl-entry">
Federer, C. A. 2002. <span>“<span>BROOK</span> 90: <span>A</span>
Simulation Model for Evaporation, Soil Water, and Streamflow.”</span> <a href="http://www.ecoshift.net/brook/brook90.htm" class="external-link">http://www.ecoshift.net/brook/brook90.htm</a>.
</div>
<div id="ref-federer_sensitivity_2003" class="csl-entry">
Federer, C. A., C. Vörösmarty, and B. Fekete. 2003. <span>“Sensitivity
of <span>Annual</span> <span>Evaporation</span> to <span>Soil</span> and
<span>Root</span> <span>Properties</span> in <span>Two</span>
<span>Models</span> of <span>Contrasting</span>
<span>Complexity</span>.”</span> <em>J. Hydrometeor</em> 4 (6): 1276–90.
</div>
<div id="ref-van_genuchten_closed-form_1980" class="csl-entry">
Genuchten, T. van. 1980. <span>“A <span>Closed</span>-Form
<span>Equation</span> for <span>Predicting</span> the
<span>Hydraulic</span> <span>Conductivity</span> of
<span>Unsaturated</span> <span>Soils</span>.”</span> <em>Soil Science
Society of America Journal</em> 44 (5): 892–98.
</div>
<div id="ref-hammel_charakterisierung_2001" class="csl-entry">
Hammel, Klaus, and Martin Kennel. 2001. <em>Charakterisierung Und
<span>Analyse</span> Der <span>Wasserverfügbarkeit</span> Und Des
<span>Wasserhaushalts</span> von <span>Waldstandorten</span> in
<span>Bayern</span> Mit Dem <span>Simulationsmodell</span>
<span>BROOK</span>90</em>. Vol. 185. Forstliche
<span>Forschungsberichte</span> <span>München</span>.
</div>
<div id="ref-mualem_new_1976" class="csl-entry">
Mualem, Y. 1976. <span>“A New Model for Predicting the Hydraulic
Conductivity of Unsaturated Porous Media.”</span> <em>Water Resource
Research</em> 12: 513–22.
</div>
<div id="ref-wessolek_bodenphysikalische_2009" class="csl-entry">
Wessolek, Gerd, Martin Kaupenjohann, and Manfred Renger. 2009.
<em>Bodenphysikalische <span>Kennwerte</span> Und
<span>Berechnungsverfahren</span> Für Die <span>Praxis</span></em>.
Bodenökologie Und <span>Bodengenese</span> 40. Berlin: Inst. für
Ökologie, Fachgebiet Bodenkunde, Standortkunde und Bodenschutz.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Paul Schmidt-Walter, Volodymyr Trotsiuk, Klaus Hammel, Martin Kennel, Anthony Federer, Bavarian State Institute of Forestry (LWF), Northwest German Forest Research Institute (NW-FVA).</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
